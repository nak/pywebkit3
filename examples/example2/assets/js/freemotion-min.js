function updateAccel(e,t,n,r){var i=$("input[name='sensor_data_type']:checked").attr("MODE");if(i==CALIBRATED){t=Math.round(t*100)/100,n=Math.round(n*100)/100,r=Math.round(r*100)/100,accel_units_set||(Math.sqrt(t*t+n*n+r*r)<2?($(".accelunits").html("<i>g</i>"),accel_units_set=!0):($(".accelunits").html("<i>m/s<sup>2</sup></i>"),accel_units_set=!0));var s=document.getElementById("accelX");s.innerHTML=""+t;var o=document.getElementById("accelY");o.innerHTML=""+n;var u=document.getElementById("accelZ");u.innerHTML=""+r}}function updateRawAccel(e,t,n,r){var i=$("input[name='sensor_data_type']:checked").attr("MODE");if(i==RAW){t=Math.round(t*100)/100,n=Math.round(n*100)/100,r=Math.round(r*100)/100,accel_units_set||(Math.sqrt(t*t+n*n+r*r)<2?$(".accelunits").html("<i>g</i>"):$(".accelunits").html("<i>m/s<sup>2</sup></i>"));var s=document.getElementById("accelX");s.innerHTML=""+t;var o=document.getElementById("accelY");o.innerHTML=""+n;var u=document.getElementById("accelZ");u.innerHTML=""+r}}function updateLinearAccel(e,t,n){linaccelActive||(setInterval(snow_loop,2e3/60),linaccelActive=!0),linaccel.x=e,linaccel.y=t,linaccel.z=n}function updateGyro(e,t,n,r){var i=$("input[name='sensor_data_type']:checked").attr("MODE");if(i==CALIBRATED){t=Math.round(t*100)/100,n=Math.round(n*100)/100,r=Math.round(r*100)/100;var s=document.getElementById("gyroX");s.innerHTML=""+t;var o=document.getElementById("gyroY");o.innerHTML=""+n;var u=document.getElementById("gyroZ");u.innerHTML=""+r;var a=5e-4;rotaccel.x=a*(-n*cameraPos.z+r*cameraPos.y),rotaccel.y=a*(t*cameraPos.z-r*cameraPos.x),rotaccel.z=a*(t*cameraPos.y-n*cameraPos.x)}}function updateRawGyro(e,t,n,r){var i=parseInt($("input[name='sensor_data_type']:checked").attr("MODE"));if(i==RAW){t=Math.round(t*100)/100,n=Math.round(n*100)/100,r=Math.round(r*100)/100;var s=document.getElementById("gyroX");s.innerHTML=""+t;var o=document.getElementById("gyroY");o.innerHTML=""+n;var u=document.getElementById("gyroZ");u.innerHTML=""+r;var a=5e-4;rotaccel.x=a*(-n*cameraPos.z+r*cameraPos.y),rotaccel.y=a*(t*cameraPos.z-r*cameraPos.x),rotaccel.z=a*(t*cameraPos.y-n*cameraPos.x)}}function updateAccelCal(){++accel_cal_count,$(".accel_cal_counter").html("Cal#: "+accel_cal_count)}function updateMagCal(){++mag_cal_count,$(".mag_cal_counter").html("Cal#: "+mag_cal_count)}function updateGyroCal(){++gyro_cal_count,gyro_cal_count<9?$(".gyro_cal_counter").html("Cal#: "+gyro_cal_count):$(".gyro_cal_counter").html("Cal#: 9+")}function updateMagAnomaly(e){e?($(container).css("background-color","darkred"),$(".mag_influenced").css("background-color","#FFE0E0")):($(container).css("background-color","black"),$(".mag_influenced").css("background-color","#FFFFFF"))}function updateYPR(yaw,pitch,roll){yaw=Math.round(yaw*100)/100,pitch=Math.round(pitch*100)/100,roll=Math.round(roll*100)/100;var y=document.getElementById("orientYAW");y.innerHTML=""+yaw;var p=document.getElementById("orientPITCH");p.innerHTML=""+pitch;var r=document.getElementById("orientROLL");r.innerHTML=""+roll,pitch=-pitch,$(".cubie").each(function(index){rotations[index]==null&&(rotations[index]=$(this).css("-webkit-transform"),rotations[index]||(rotations[index]=$(this).css("-moz-transform")),rotations[index]||(rotations[index]=$(this).css("-ms-transform")),n[index]=eval($(this).attr("n")));var newndoty=-Math.cos(TO_RADIANS*pitch)*Math.cos(TO_RADIANS*yaw)*n[index][1]-(Math.sin(TO_RADIANS*roll)*Math.sin(TO_RADIANS*yaw)+Math.cos(TO_RADIANS*roll)*Math.sin(TO_RADIANS*pitch)*Math.cos(TO_RADIANS*yaw))*n[index][2]-(Math.cos(TO_RADIANS*roll)*Math.sin(TO_RADIANS*yaw)-Math.sin(TO_RADIANS*roll)*Math.sin(TO_RADIANS*pitch)*Math.cos(TO_RADIANS*yaw))*n[index][0];csstext="rotateY("+yaw+"deg) rotateX("+pitch+"deg) rotateZ("+roll+"deg) "+rotations[index],newndoty<=0?$(this).css("display","none"):$(this).css("display","block"),$(this).css("-webkit-transform",csstext),$(this).css("-moz-transform",csstext),$(this).css("-ms-transform",csstext)})}function updateOrient(e,t,n,r,i){n=Math.round(n*1e3)/1e3,r=Math.round(r*1e3)/1e3,i=Math.round(i*1e3)/1e3,t=Math.round(t*1e3)/1e3;var s=document.getElementById("orientX");s.innerHTML=""+n;var o=document.getElementById("orientY");o.innerHTML=""+r;var u=document.getElementById("orientZ");u.innerHTML=""+i;var a=document.getElementById("orientW");a.innerHTML=""+t}function updateMag(e,t,n,r){var i=parseInt($("input[name='sensor_data_type']:checked").attr("MODE"));if(i==CALIBRATED){t=Math.round(t*1e3)/1e3,n=Math.round(n*1e3)/1e3,r=Math.round(r*1e3)/1e3;var s=document.getElementById("magX");s.innerHTML=""+t;var o=document.getElementById("magY");o.innerHTML=""+n;var u=document.getElementById("magZ");u.innerHTML=""+r}}function updateRawMag(e,t,n,r){var i=parseInt($("input[name='sensor_data_type']:checked").attr("MODE"));if(i==RAW){t=Math.round(t*1e3)/1e3,n=Math.round(n*1e3)/1e3,r=Math.round(r*1e3)/1e3;var s=document.getElementById("magX");s.innerHTML=""+t;var o=document.getElementById("magY");o.innerHTML=""+n;var u=document.getElementById("magZ");u.innerHTML=""+r}}function freemotion_init(){container=document.createElement("div"),$("#canvas")[0].appendChild(container),$(container).width(SCREEN_WIDTH),$(container).height(SCREEN_HEIGHT),$(container).css("background-color","black"),camera=new THREE.PerspectiveCamera(75,1,1,1e4),camera.position.z=1e3,scene=new THREE.Scene,scene.add(camera),renderer=new THREE.CanvasRenderer,renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT);var e=new THREE.ParticleBasicMaterial({map:new THREE.Texture(particleImage)});for(var t=0;t<500;t++)particle=new Particle3D(e),particle.position.x=Math.random()*2e3-1e3,particle.position.y=Math.random()*2e3-1e3,particle.position.z=Math.random()*2e3-1e3,particle.scale.x=particle.scale.y=1,scene.add(particle),particles.push(particle);container.appendChild(renderer.domElement),updateYPR(-45,45,45),$("textarea").css("font-weight","bold")}function enable_unit_test(){setInterval(test_loop,1e3/60)}function onDocumentMouseMove(e){mouseX=e.clientX-windowHalfX,mouseY=e.clientY-windowHalfY}function onDocumentTouchStart(e){e.touches.length==1&&(e.preventDefault(),mouseX=e.touches[0].pageX-windowHalfX,mouseY=e.touches[0].pageY-windowHalfY)}function onDocumentTouchMove(e){e.touches.length==1&&(e.preventDefault(),mouseX=e.touches[0].pageX-windowHalfX,mouseY=e.touches[0].pageY-windowHalfY)}function test_loop(){YPR[0]+=.3,YPR[1]+=sign*.5,YPR[2]+=.7,YPR[2]>90&&(sign=-sign,YPR[2]-=180,YPR[0]-=180,YPR[1]=180-YPR[1]),YPR[0]>=360?YPR[0]-=360:YPR[0]<0&&(YPR[0]+=360),YPR[1]>=180?YPR[1]-=360:YPR[1]<-180&&(YPR[1]+=360),simtime<100?setConnectionStatus(!1,"Faking it out "+simtime):setConnectionStatus(!0,"Faked connection"),linaccel.x=.06*Math.sin(TO_RADIANS*YPR[0]),linaccel.y=.06*Math.cos(TO_RADIANS*YPR[0]),updateGyro(0,1*Math.sin(TO_RADIANS*YPR[0]),-1*Math.sin(TO_RADIANS*YPR[0]),1),updateYPR(YPR[0],YPR[1],YPR[2]),updateAccel(0,linaccel.x,linaccel.y,linaccel.y),updateLinearAccel(0,linaccel.x,linaccel.y,linaccel.y),updateMagAnomaly(simtime<500),updateAccelCal(),updateGyroCal(),updateMagCal(),simtime+=1}function snow_loop(){for(var i=0;i<particles.length;i++){var particle=particles[i];particle.updatePhysics();with(particle.position){factor=7.5;while(y<-factor*SCREEN_WIDTH/2)y+=factor*SCREEN_WIDTH;while(y>factor*SCREEN_WIDTH/2)y-=factor*SCREEN_WIDTH;while(x>factor*SCREEN_WIDTH/2)x-=factor*SCREEN_WIDTH;while(x<-factor*SCREEN_WIDTH/2)x+=factor*SCREEN_WIDTH;z>100?z-=2e3:z<-100&&(z+=2e3)}}camera.position.x=cameraPos.x,camera.position.y=cameraPos.y,camera.position.z=cameraPos.z,camera.lookAt(scene.position),renderer.render(scene,camera)}var cameraPos={x:0,y:0,z:100},linaccel=new THREE.Vector3(0,0,0),rotaccel=new THREE.Vector3(0,0,0),rotations=[null,null,null,null,null,null],n=[null,null,null,null,null,null];const CALIBRATED=0,RAW=1;var accel_units_set=!1,SCREEN_WIDTH=250,SCREEN_HEIGHT=200,container,particle,camera,scene,renderer,mouseX=0,mouseY=0,particles=[],particleImage=new Image;particleImage.src="img/ParticleSmoke.png";var linaccelActive=!1,accel_cal_count=0,mag_cal_count=0,gyro_cal_count=0,windowHalfX,windowHalfY;$(document).ready(function(){windowHalfX=$("#canvas")[0].innerWidth/2,windowHalfY=$("#canvas")[0].innerHeight/2,$("#startlogbtn").click(function(){$(this).html()=='<span class="ui-button-text">Start Logging</span>'||$(this).html()=="Start Logging"?($(this).html('<span class="ui-button-text">Stop Logging</span>'),document.title="logging-start"):($(this).html('<span class="ui-button-text">Start Logging</span>'),document.title="logging-stop")}),$(".button").button()});var YPR=[45,45,-45],simtime=0,sign=1;